#!/bin/bash

set -euo pipefail

source .buildkite/scripts/common.sh

unset_secrets

if [[ "$BUILDKITE_PIPELINE_SLUG" == "golang-crossbuild" && "$BUILDKITE_STEP_KEY" =~ ^build ]]; then
    google_cloud_logout_active_account
fi

if [[ "$BUILDKITE_PIPELINE_SLUG" == "golang-crossbuild" && ("$BUILDKITE_STEP_KEY" =~ ^build || "$BUILDKITE_STEP_KEY" =~ ^publish) ]]; then
    docker logout "${DOCKER_REGISTRY}"
fi

# Ensure that any temporal files created during any step are removed
cleanup
